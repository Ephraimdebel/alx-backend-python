#!/bin/bash
# Script to scale the Django app and monitor its performance

# Step 1: Scale the Django deployment to 3 replicas
echo "🚀 Scaling the Django messaging app to 3 replicas..."
kubectl scale deployment messaging-app-deployment --replicas=3

# Step 2: Verify that multiple pods are running
echo "✅ Verifying running pods..."
kubectl get pods -l app=messaging-app

# Step 3: Perform load testing using wrk
# (wrk should be installed inside the environment)
echo "⚙️ Performing load testing on the app using wrk..."
wrk -t4 -c100 -d30s http://messaging-app-service:8000/

# Step 4: Monitor resource usage
echo "📊 Monitoring resource usage..."
kubectl top pods